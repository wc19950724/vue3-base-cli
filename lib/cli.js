#!/usr/bin/env node
'use strict';

var h = require('prompts');
var rimraf = require('rimraf');
var child_process = require('child_process');
var k = require('fs');
var $ = require('path');
var cac = require('cac');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var h__default = /*#__PURE__*/_interopDefault(h);
var k__default = /*#__PURE__*/_interopDefault(k);
var $__default = /*#__PURE__*/_interopDefault($);

var nt=Object.create;var d=Object.defineProperty,ot=Object.defineProperties,ct=Object.getOwnPropertyDescriptor,at=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertyNames,z=Object.getOwnPropertySymbols,gt=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable;var P=(t,e,r)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,I=(t,e)=>{for(var r in e||(e={}))D.call(e,r)&&P(t,r,e[r]);if(z)for(var r of z(e))pt.call(e,r)&&P(t,r,e[r]);return t},T=(t,e)=>ot(t,at(e));var lt=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var x=(t,e)=>()=>(t&&(e=t(t=0)),e);var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ut=(t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0});},xt=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of mt(e))!D.call(t,i)&&i!==r&&d(t,i,{get:()=>e[i],enumerable:!(s=ct(e,i))||s.enumerable});return t};var ft=(t,e,r)=>(r=t!=null?nt(gt(t)):{},xt(e||!t||!t.__esModule?d(r,"default",{value:t,enumerable:!0}):r,t));var m=(t,e,r)=>new Promise((s,i)=>{var a=c=>{try{b(r.next(c));}catch(u){i(u);}},g=c=>{try{b(r.throw(c));}catch(u){i(u);}},b=c=>c.done?s(c.value):Promise.resolve(c.value).then(a,g);b((r=r.apply(t,e)).next());});var q,E,_=x(()=>{q="vue3-base-cli",E="1.1.4";});var J,M=x(()=>{J="https://github.com/wc19950724/vue3-base.git";});var Y,B,L,v,N=x(()=>{S();Y=t=>m(void 0,null,function*(){let e=yield h__default.default([{type:"text",name:"name",message:"Project name:",initial:t,validate:r=>/^(?:@[a-z0-9-*~][a-z0-9-*._~]*)?[a-z0-9-~][a-z0-9-._~]*$/.test(r)?!0:"The project name does not meet the specifications: ^(?:@[a-z0-9-*~][a-z0-9-*._~]*)?[a-z0-9-~][a-z0-9-._~]*$"},{type:"text",name:"description",message:"description:",validate:r=>/^.{0,100}$/.test(r)?!0:"The description must not exceed 100 characters"},{type:"text",name:"author",message:"author:",validate:r=>/^.{0,50}$/.test(r)?!0:"The author must not exceed 50 characters"}]);return Object.keys(e).length!==3?null:e}),B=(t,e)=>m(void 0,null,function*(){let{action:r}=yield h__default.default([{type:"toggle",name:"action",message:`Delete existing directory <${t}>?`,initial:"Y",active:"Yes",inactive:"no"}]);return r?(l(`Delete directory: '${t}'`),yield rimraf.rimraf(e),Promise.resolve()):Promise.reject("Cancelled creation")}),L=t=>m(void 0,null,function*(){let{yes:e}=yield h__default.default([{type:"confirm",name:"yes",message:"install packages?",initial:!0}]);if(!e)return !1;process.chdir(t);let r=yield v();(yield G(r))||(yield p("npm",["install","-g",r])),l(`${r} version`),yield p(r,["--version"]);try{yield p(r,["install","--prefer-offline"]);}catch(i){yield p(r,["install"]);}return l("Dependency installation successful!"),!0}),v=(t=!0)=>m(void 0,null,function*(){let e="npm",r=Q();if(r.length===1)e=r[0];else if(r.length>1)if(t){let{result:s}=yield h__default.default({type:"select",name:"result",message:"Select cmd type",choices:r.map(i=>({value:i,title:i}))});e=s;}else e=`(${r.join(" | ")})`;return e});});var A=F((_t,j)=>{var yt=lt("tty"),dt=!("NO_COLOR"in process.env||process.argv.includes("--no-color"))&&("FORCE_COLOR"in process.env||process.argv.includes("--color")||process.platform==="win32"||yt.isatty(1)&&process.env.TERM!=="dumb"||"CI"in process.env),n=(t,e,r=t)=>s=>{let i=""+s,a=i.indexOf(e,t.length);return ~a?t+V(i,e,r,a)+e:t+i+e},V=(t,e,r,s)=>{let i=t.substring(0,s)+r,a=t.substring(s+e.length),g=a.indexOf(e);return ~g?i+V(a,e,r,g):i+a},W=(t=dt)=>({isColorSupported:t,reset:t?e=>`\x1B[0m${e}\x1B[0m`:String,bold:t?n("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"):String,dim:t?n("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"):String,italic:t?n("\x1B[3m","\x1B[23m"):String,underline:t?n("\x1B[4m","\x1B[24m"):String,inverse:t?n("\x1B[7m","\x1B[27m"):String,hidden:t?n("\x1B[8m","\x1B[28m"):String,strikethrough:t?n("\x1B[9m","\x1B[29m"):String,black:t?n("\x1B[30m","\x1B[39m"):String,red:t?n("\x1B[31m","\x1B[39m"):String,green:t?n("\x1B[32m","\x1B[39m"):String,yellow:t?n("\x1B[33m","\x1B[39m"):String,blue:t?n("\x1B[34m","\x1B[39m"):String,magenta:t?n("\x1B[35m","\x1B[39m"):String,cyan:t?n("\x1B[36m","\x1B[39m"):String,white:t?n("\x1B[37m","\x1B[39m"):String,gray:t?n("\x1B[90m","\x1B[39m"):String,bgBlack:t?n("\x1B[40m","\x1B[49m"):String,bgRed:t?n("\x1B[41m","\x1B[49m"):String,bgGreen:t?n("\x1B[42m","\x1B[49m"):String,bgYellow:t?n("\x1B[43m","\x1B[49m"):String,bgBlue:t?n("\x1B[44m","\x1B[49m"):String,bgMagenta:t?n("\x1B[45m","\x1B[49m"):String,bgCyan:t?n("\x1B[46m","\x1B[49m"):String,bgWhite:t?n("\x1B[47m","\x1B[49m"):String});j.exports=W();j.exports.createColors=W;});var o={};ut(o,{default:()=>ht,error:()=>H,gray:()=>tt,info:()=>U,log:()=>Z,success:()=>X,warn:()=>K});var f,H,K,U,X,Z,tt,ht,et=x(()=>{f=ft(A()),H=t=>{console.log(f.default.red(t));},K=t=>{console.log(f.default.yellow(t));},U=t=>{console.log(f.default.blue(t));},X=t=>{console.log(f.default.green(t));},Z=(...t)=>{console.log(...t);},tt=t=>{console.log(f.default.gray(t));},ht={error:H,warn:K,info:U,success:X,log:Z,gray:tt};});var Q,rt,p,l,G,st=x(()=>{S();Q=()=>{let t=[];return k.existsSync("package-lock.json")?t.push("npm"):k.existsSync("yarn.lock")?t.push("yarn"):k.existsSync("pnpm-lock.yaml")&&t.push("pnpm"),t},rt=t=>{let e=k.readFileSync($.resolve(t),"utf8");return JSON.parse(e).scripts||{}},p=(t,e,r)=>{try{let s=child_process.execSync(`${t} ${e.join(" ")}`,T(I({stdio:"inherit"},r),{encoding:"utf-8"}));return s&&(r==null?void 0:r.stdio)!=="pipe"&&o.log(s),s}catch(s){return Promise.reject(s)}},l=t=>o.success(`
${t}`),G=t=>m(void 0,null,function*(){try{return !!(yield p("which",[t],{stdio:"ignore"}))}catch(e){return !1}});});var S=x(()=>{N();et();st();});var $t=F(O=>{_();M();S();var kt=()=>m(O,null,function*(){let t=cac.cac(q);t.command("create <project-name>").option("-g, --git","git clone url").action((e,r)=>m(O,null,function*(){try{let s;try{if(s=yield Y(e),!s)return}catch(y){return}let i=$__default.default.join(process.cwd(),e);if(k__default.default.existsSync(i))try{yield B(e,i);}catch(y){return}l("Clone remote warehouse..."),yield p("git",["clone",r.git||J,i]);let a=$__default.default.join(i,".git");yield rimraf.rimraf(a);let g=$__default.default.join(i,"package.json"),b=k__default.default.readFileSync(g,"utf8"),c=JSON.parse(b);c.name=s.name,c.author=s.author,c.description=s.description,k__default.default.writeFileSync(g,JSON.stringify(c,null,2)+`
`),l("Project created successfully!");let u,w;try{u=yield L(i),w=yield v(!1);}catch(y){return}o.log(`
`),o.info(`	cd ${s.name}`),!u&&o.info(`	${w} install`);let it=rt(g);for(let y in it)o.info(`	${w} ${y}`);o.log(`
`);}catch(s){s instanceof Error?o.error(`${s.name}: ${s.message}`):o.log(s);}})),t.help(),t.version(E),t.parse(process.argv);});kt().catch(t=>{t instanceof Error?o.error(`${t.name}: ${t.message}`):o.log(t);});});var cli = $t();

module.exports = cli;
